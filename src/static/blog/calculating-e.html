<!DOCTYPE html>
<html lang="en">
<head><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app57.us.archive.org';v.server_ms=2559;archive_analytics.send_pageview({});});</script><script type="text/javascript" src="/_static/js/playback.bundle.js?v=BsQ6byDz" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=cRqOKCOw" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("http://curtisautery.appspot.com/5825281323433984","20170702101405","https://web.archive.org/","web","/_static/",
	      "1498990445");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=NHuXCfBH" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
<!-- End Wayback Rewrite JS Include -->

	<meta charset="utf-8">
	
		
		<title>Calculating e with Javascript</title>
		<meta name="description" content="An exploration of how numbers are truly represented in Javascript, and how to use that to calculate e with the most decimal precision">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="author" content="Curtis Autery">

	<link href="/web/20170702101405cs_/http://curtisautery.appspot.com/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">

	<style type="text/css">
		#cover {
			background-size: 100% auto;
			background-image: url(/web/20170702101405im_/http://curtisautery.appspot.com/static/cover.jpg);
			border-radius: 6px;
			margin-top: -20px;
		}

		#cover h1 {
			color: #fff;
			background: rgba(0, 0, 0, 0.4);
			line-height: 1.5;
			font-size: 2em;
		}

		@media screen and (min-width: 768px) {
			#cover h1 {
			    font-size: 63px;
			}

			#body {
				text-align: justify;
			}
		}

		hr {
			border-top: 1px solid gray;
		}

		img {
			margin-bottom: 5px;
		}
	</style>

	<script type="text/javascript">
		function populate_entries( entries ) {
			$( '#entries' ).empty();
			for ( var e in entries ) add_entry( entries[e].Title, entries[e].ID );
		}

		function add_entry( title, key ) {
			var html = '<li><a href="/' + key + '">' + title + '</a></li>';
			$( '#entries' ).append( html );
		}

		function init() {
			if (document.location.pathname == "/1") $('#About').addClass("active");
			if (document.location.pathname == "/") {
				$('#Home').addClass("active");
				$('#latest').empty();
			} else {
				$.ajax({
					url: '/list',
					type: 'GET',
					success: function( results ) {
						populate_entries( $.parseJSON( results ) );
					},
					error: function( xhr, ajaxOptions, thrownError ) {
						console.log( xhr );
						console.log( ajaxOptions );
						alert( thrownError );
					}
				});
			}
		}
	</script>
</head>
<body onload="init()"><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="wm-ipp-inside">
  <div style="position:relative;">
    <div id="wm-logo" style="float:left;width:110px;padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="r" style="float:right;">
      <div id="wm-btns" style="text-align:right;height:25px;">
                  <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#"
	     title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php"
             title="Sign In"
             id="wm-sign-in"
          >
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
        	<a href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	<a id="wm-tb-close" href="#close" onclick="__wm.h(event);return false;" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share">
          <a href="/web/20170702101405/http://web.archive.org/screenshot/http://curtisautery.appspot.com/5825281323433984"
             id="wm-screenshot"
             title="screenshot">
            <span class="wm-icon-screen-shot"></span>
          </a>
	<a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20170702101405/http://curtisautery.appspot.com/5825281323433984" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	<a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20170702101405/http://curtisautery.appspot.com/5825281323433984" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
    </div>
    <table class="c" style="">
      <tbody>
	<tr>
	  <td class="u" colspan="2">
	    <form target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://curtisautery.appspot.com/5825281323433984" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20170702101405" /><input type="submit" value="Go" /></form>
	  </td>
	  <td class="n" rowspan="2" style="width:110px;">
	    <table>
	      <tbody>
		<!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
		<tr class="m">
		  <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20161018130408/http://curtisautery.appspot.com/5825281323433984" title="18 Oct 2016"><strong>Oct</strong></a></td>
		  <td class="c" id="displayMonthEl" title="You are here: 10:14:05 Jul 02, 2017">JUL</td>
		  <td class="f" nowrap="nowrap">Aug</td>
		</tr>
		<!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
		<tr class="d">
		  <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20161018130408/http://curtisautery.appspot.com/5825281323433984" title="13:04:08 Oct 18, 2016"><img src="/_static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a></td>
		  <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;" title="You are here: 10:14:05 Jul 02, 2017">02</td>
		  <td class="f" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0" /></td>
		</tr>
		<!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
		<tr class="y">
		  <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20160503221122/http://curtisautery.appspot.com:80/5825281323433984" title="03 May 2016"><strong>2016</strong></a></td>
		  <td class="c" id="displayYearEl" title="You are here: 10:14:05 Jul 02, 2017">2017</td>
		  <td class="f" nowrap="nowrap">2018</td>
		</tr>
	      </tbody>
	    </table>
	  </td>
	</tr>
	<tr>
	  <td class="s">
	    	    <div id="wm-nav-captures">
	      	      <a class="t" href="/web/20170702101405*/http://curtisautery.appspot.com/5825281323433984" title="See a list of every capture for this URL">6 captures</a>
	      <div class="r" title="Timespan for captures of this URL">07 Jan 2014 - 02 Jul 2017</div>
	      </div>
	  </td>
	  <td class="k">
	    <a href="" id="wm-graph-anchor">
	      <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
		<canvas id="wm-sparkline-canvas" width="625" height="27" border="0"></canvas>
	      </div>
	    </a>
	  </td>
	</tr>
      </tbody>
    </table>
    <div style="position:absolute;bottom:0;right:2px;text-align:right;">
      <a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span style="font-size:80%">About this capture</span></a>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
                    <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/webwidecrawl);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/webwidecrawl" target="_new"><span class="wm-title">Internet Archive</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  The Internet Archive discovers and captures web pages through many different web crawls.

At any given time several distinct crawls are running, some for months, and some every day or longer.

View the web archive through the <a href="http://archive.org/web/web.php">Wayback Machine</a>.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/survey_00005)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/survey_00005" target="_new"><span class="wm-title">Survey Crawl Number 5: Oct 21st, 2016 to Sep 10th, 2017</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  <p>The seed for this crawl was a list of every host in the Wayback Machine</p>

<p>This crawl was run at a level 1 (URLs including their embeds, plus the URLs of all outbound links including their embeds)</p>

<p>The WARC files associated with this crawl are not currently available to the general public.</p>
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;transpiled=0&amp;referer=https%3A//web.archive.org/web/20170702101405/http%3A//curtisautery.appspot.com/5825281323433984"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><script type="text/javascript">
__wm.bt(625,27,25,2,"web","http://curtisautery.appspot.com/5825281323433984","20170702101405",1996,"/_static/",["/_static/css/banner-styles.css?v=NHuXCfBH","/_static/css/iconochive.css?v=qtvMKcIJ"]);
  __wm.rw(1);
</script>
<!-- END WAYBACK TOOLBAR INSERT -->
	<div class="navbar navbar-inverse navbar-static-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>

			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li id="Home"><a href="/web/20170702101405/http://curtisautery.appspot.com/">Home</a></li>
					<li id="latest" class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							Latest
							<b class="caret"></b>
						</a>
						<ul id="entries" class="dropdown-menu">
							<li class="muted"><a href="javascript:blur()">loading...</a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li id="About"><a href="/web/20170702101405/http://curtisautery.appspot.com/1">About</a></li>
					
				</ul>
			</div>
		</div>
	</div>

	<div class="container col-xs-12 col-md-8 col-md-offset-2">
		<div id="cover">
			<h1 class="text-center jumbotron">Stories for Outcasts</h1>
		</div>

		
			<h3 class="text-center">
				
					Calculating e with Javascript
				
			</h3>
			<h4>Tuesday, November 26, 2013</h4>
			<div id="body">
				<p><style>code {color:black;font-size:100%}</style></p>

<blockquote>
<p>"In showing a painting to probably a critical or venomous lady, anger dominates. O take guard, or she raves and shouts." - Martin Gardner</p>


</blockquote>

<p>The odd quote above is from one of Gardner's mathematical puzzles columns in Scientific American, and is a mnemonic aid for building the mathematical constant <em>e</em> based on the lengths of each word, where the "O" from "O take guard" represents zero. Here's a quick Javascript console snippet showing how it works (and a shout out to my fellow regex nerds):</p>



<pre><code>&gt; a = &#34;In showing a painting to probably a critical or venomous lady, anger dominates. O take guard, or she raves and shouts&#34;.split(/&#92;W+O?/)
&#91;&#34;In&#34;, &#34;showing&#34;, &#34;a&#34;, &#34;painting&#34;, &#34;to&#34;, &#34;probably&#34;, &#34;a&#34;, &#34;critical&#34;, &#34;or&#34;, &#34;venomous&#34;, &#34;lady&#34;, &#34;anger&#34;, &#34;dominates&#34;, &#34;&#34;, &#34;take&#34;, &#34;guard&#34;, &#34;or&#34;, &#34;she&#34;, &#34;raves&#34;, &#34;and&#34;, &#34;shouts&#34;&#93;
&gt; b = &#34;&#34;; for (var c in a) b += a&#91;c&#93;.length
  &#34;271828182845904523536&#34;
&gt; Math.E
  2.718281828459045
</code></pre>



<p><em>e</em> is, of course, the base of natural logarithms, the number representing 100% interest compounded continuously, and appears in a host of other maths and natural phenomena. This isn't a detailed account of <em>e</em> and its uses, but rather an explanation of what's going on under the hood when calculating <em>e</em> using IEEE-754 double-precision binary floating points - the only number format used in Javascript.</p>

<p>First off, Yes: Javascript doesn't have user-accessible integers. At all. It only has a primitive data type "number", represented by 64 bit floats, that users can manipulate. Curiously, the <a href="https://web.archive.org/web/20170702101405/http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf">EMCA 262 standard</a> for Javascript calls for "abstract operations" which convert user accessible numbers to and from internal representations of signed or unsigned integers for various operations.</p>

<p>One of the built-in expressions that employs that is bit-shifting, which according to the spec converts the left and right sides of the expression to signed and unsigned 32 bit integers, respectively, e.g.:</p>

<blockquote>
<h3>11.7.1 The Left Shift Operator ( &lt;&lt; )</h3>

<p>Performs a bitwise left shift operation on the left operand by the amount specified by the right operand.</p>

<p>The production <em>ShiftExpression : ShiftExpression &lt;&lt; AdditiveExpression</em> is evaluated as follows:</p>

<ol>
<li>Let lref be the result of evaluating ShiftExpression.</li>
<li>Let lval be GetValue(lref).</li>
<li>Let rref be the result of evaluating AdditiveExpression.</li>
<li>Let rval be GetValue(rref).</li>
<li>Let lnum be ToInt32(lval).</li>
<li>Let rnum be ToUint32(rval).</li>
<li>Let shiftCount be the result of masking out all but the least significant 5 bits of rnum, that is, compute rnum &amp; 0x1F.</li>
<li>Return the result of left shifting lnum by shiftCount bits. The result is a signed 32-bit integer.</li>
</ol>

<p>&nbsp;</p>


</blockquote>

<p>First off, those instructions are horrible, however functional specs often suffer from this odd blend of verbosity and committee-speak. Interestingly, the rules imply bit shifting won't work on numbers larger than what can be represented by 32 bit ints. They also imply that bit shifting in Javascript may be less efficient than simply multiplying by a power of 2, since each operation involves casting to an int and back.</p>

<p>I say "may be" because after some very unscientific timing comparisons of <code>1 &lt;&lt; 20</code> vs <code>Math.pow(2, 20)</code>, there was no clear winner. I attribute this to the recent speed wars of modern Javascript engines, employing various on the fly compiling and other optimizations, resulting in unpredictable speed test results, particularly after a warmup period.</p>

<h3>First steps</h3>

<p>Q) What the hell is a float, really?</p>

<p>In IEEE 754, a double-precision float is a sign bit, 11 exponent bits offset by -1023, and 52 mantissa bits, expressed by this equation:</p>

<p><code>-1<sup>sign</sup> &times; 2<sup>exp-1023</sup> &times; 1.mantissa</code></p>

<p>...and for the low cost of $89, you can independently verify that from IEEE. As a cost-saving measure, I took the risky position of just <a href="https://web.archive.org/web/20170702101405/http://en.wikipedia.org/wiki/Double-precision%5Ffloating-point%5Fformat">trusting Wikipedia</a>.</p>

<p>There are special cases for the min and max exponents (subnormals and infinity/NaN) which I won't go over, but for all other exponents the above equation is used. Let's go over a few examples:</p>

<p><strong>Decimal 1.0</strong></p>

<p>Starting very simply, let's look at the float representation of 1.</p>



<pre><code>Sign:        0 (+)
Exponent: 1023 (0)
Mantissa:    0
</code></pre>



<p>The <code>-1<sup>sign</sup></code> expression may be awkward if you are more of a programmer than a maths nerd. If that's the case, think of the sign bit as an "isNegative" flag. When the flag is 0, the expression evaluates to 1 (positive, i.e., isNegative is false, anything raised to 0 is 1), and when the flag is 1, the expression evaluates to -1 (raising to 1 is an identity operation). The results of that expression are then multiplied in with the results of the exponent and mantissa expressions, either leaving them alone or negating them, depending on the sign bit's value.</p>

<p>The exponent value given in the float is offset by -1023, so if I want a calculated exponent of 0 (so that the mantissa is multiplied by 2<sup>0</sup> = 1), I use a real float of 1023. The equation for the float is then:</p>

<p><code>-1<sup>0</sup> &times; 2<sup>0</sup> &times; 1.0</code></p>

<p>...or...</p>

<p><code>1 &times; 1 &times; 1.0</code></p>

<p>The content of the float's 64 bits then, is:</p>

<p>Binary contents:</p>



<pre><code>|s|-Exponent--|----------------------Mantissa----------------------|
 0 01111111111 0000000000000000000000000000000000000000000000000000
Hex representation:
|s+e|--Mantissa---|
 3FF 0000000000000
</code></pre>



<p><strong>Decimal -2.0</strong></p>



<pre><code>Sign:        1 (-)
Exponent: 1024 (1)
Mantissa:    0

Binary:
|s|-Exponent--|----------------------Mantissa----------------------|
 1 10000000000 0000000000000000000000000000000000000000000000000000
Hex:
|s+e|--Mantissa---|
 C00 0000000000000
</code></pre>



<p>If you ever find yourself looking at bit values for floats, a good rule to remember is if only the first exponent bit is set (making the hex representation start with 400 or C00), that represents an exponent of 1, and an exponent expression of <code>2<sup>1</sup></code>, or 2. The equation for this float is:</p>

<p><code>-1<sup>1</sup> &times; 2<sup>1</sup> &times; 1.0</code></p>

<p>...or...</p>

<p><code>-1 &times; 2 &times; 1.0</code></p>

<p><strong>Decimal 0.4375 (7/16)</strong></p>



<pre><code>Exp: 1021 (-2)
Mantissa: 110...

Binary:
|s|-Exponent--|----------------------Mantissa----------------------|
 0 01111111101 1100000000000000000000000000000000000000000000000000
Hex:
|s+e|--Mantissa---|
 3FD C000000000000
</code></pre>



<p>The ellipse after "110" I use to refer to <span style="text-decoration:overline;">0</span>, or, "here's where there's nothing else but repeating zeroes in the mantissa". So 7/16ths is being represented here as binary 1.11 * 2<sup>-2</sup>, or binary .0111. So what does that mean exactly?</p>

<p>You already know how decimal fractions work: Each digit is worth a tenth of the one on it's left. .07 is a tenth the size of .7. In binary, each digit is worth half the one on its left, so .1 is half of 1, .01 is half of .1 (and a quarter of 1), etc. So our .0111 is:</p>



<pre><code>0/2 + 1/4 + 1/8 + 1/16 = 4/16 + 2/16 + 1/16 = 7/16
</code></pre>



<p><strong> Decimal 43,046,721</strong></p>



<pre><code>Exp: 1048 (25)
Mantissa: 01001000011010111010000010...
</code></pre>



<p>43046721 is an old favorite number of mine, representing the highest power of 3 that could fit on old-school pocket calculators that could only display 8 decimal digits, and would overflow on anything larger, returning just "E" for the answer. The number also appears in a lot of "homework help" questions on the Internet, where students go to great lengths to not learn simple concepts, spending vastly more energy dodging work than the work would entail. The question is usually this one:</p>



<pre><code>&gt; Fill in the missing number in this sequence:
&gt; 3, 9, ..., 6561, 43046721.
</code></pre>



<p>Anyway, as a power of 3, the number requires more binary ones to express than you might expect, eleven total, including the implied 1 to the left of the mantissa. This is also the range of number I prefer to not try to convert to binary in my head, but use a calculator with that capability, or a Javascript console one-liner such as:</p>



<pre><code>&gt; (43046721).toString(2)
  &#34;10100100001101011101000001&#34;
</code></pre>



<p>That results in 26 binary digits, which is expressible in float-speak as:</p>

<p><code>2<sup>25</sup> &times; 1.0100100001101011101000001</code></p>

<p>...and adding back in the 1023 offset on the exponent gives us 1048. Using our Javascript convertulatorizer shows us the binary:</p>



<pre><code>&gt; (1048).toString(2)
  &#34;10000011000&#34;
</code></pre>



<p>...making our float value:</p>



<pre><code>Binary:
|s|-Exponent--|----------------------Mantissa----------------------|
 0 10000011000 0100100001101011101000001000000000000000000000000000
Hex:
|s+e|--Mantissa---|
 418 486BA08000000
</code></pre>



<p><strong> Decimal 0.1</strong></p>

<p>Have you ever seen something like this as a result of a decimal operation, in any programming language?</p>



<pre><code>&gt; .7 + .1
  0.7999999999999999
&gt; 1.3 + .1
  1.4000000000000001
</code></pre>



<p>What causes that is a rounding error necessary to represent a base 10 fraction in base 2. Since there are no factors of 2 that are multiples of 10... actually, let me show you that:</p>



<pre><code>   2
   4
   8
  16
  32
  64
 128
 256
 512
1024
2048
4096
8192
</code></pre>



<p>Note how the last digits repeat the sequence 2, 4, 8, 6. Nothing ends with 0, which means there is no way to express exactly one tenth using binary fractions. The closest you can come is binary .0<span style="text-decoration:overline;">0011</span>, or:</p>



<pre><code>1/16 + 1/32 + 1/256 + 1/512 + 1/4096 + 1/8192...
</code></pre>



<p>This can be simplified to:</p>



<pre><code>3/32 + 3/512 + 3/8192 + 3/131,072...
</code></pre>



<p>Does this really repeat by adding 3/(next power of 2 ending in 2)? Yes, which I'll demonstrate. To start with, subtract one tenth by three thirty-seconds:</p>



<pre><code>1/10 - 3/32 = 32/320 - 30/320 = 2/320 = 1/160
</code></pre>



<p>The difference is 1/160, or 1/(32 &times; 5), 32 being the fractional place you were subtracting with. Now watch what happens when you subtract .1 by (3/32 + 3/512). First, let's simplify that last term:</p>



<pre><code>3/32 = 48/512, so 3/32 + 3/512 = 51/512
</code></pre>



<p>Now do the subtraction:</p>



<pre><code>1/10 - 51/512 = 512/5120 - 510/5120 = 2/5120 = 1/2560
</code></pre>



<p>You are left with 1/2560, or 1/(512 &times; 5), which again is 5 times the fractional place you were subtracting with. As you keep going, you remain 1/(5 &times; current fraction) away from one tenth. Once we get to the end of our 52 mantissa digits, some sort of rounding needs to take place. Javascript itself can tell you how it does the rounding:</p>



<pre><code>&gt; (.1).toString(2)
 &#34;0.0001100110011001100110011001100110011001100110011001101&#34;
</code></pre>



<p>The last "1" should have been "011", but was rounded up so that the resulting binary fraction could fit in the mantissa. This means that .1 to Javascript means:</p>



<pre><code> 3,602,879,701,896,397
----------------------
36,028,797,018,963,968
</code></pre>



<p>As far as estimation goes, being a couple quadrillionths off isn't half bad, however it happens to be just outside of the decimal range Javascript can display. There are a handful of additions between two float64 estimations of decimal digits that, when added together, are under this threshold, and Javascript (or your language of choice) exposes the fact that it's just been estimating all this time.</p>

<p>As any programming guide worth its salt will mention, if you need exact decimals, don't rely on floating points to give them to you. Either stick with whole numbers and divide at the end, or use a library that manages exact decimals for you.</p>

<p>Representing decimal .1 as a float looks like this:</p>



<pre><code>Exp: 1019 (-4)
Mantissa: 100110011001100110011001100110011001100110011001101

Binary:
|s|-Exponent--|----------------------Mantissa----------------------|
 0 01111111011 1001100110011001100110011001100110011001100110011010
Hex:
|s+e|--Mantissa---|
 3FB 999999999999A
</code></pre>



<p>The hex representation of the mantissa is very interesting. Binary 1001 = hex 9.</p>

<h3>Calculating <em>e</em></h3>

<p><em>e</em> to 50 digits is 2.71828182845904523536028747135266249775724709369995, however a float64 can't allocate that many decimal digits of precision. Since our mantissa is 52 binary bits, that gives us <code>Log<sub>10</sub>2<sup>52</sup> = 15.65355977452702</code> decimal digits of precision, matching the number of decimal digits in the Math.E Javascript constant:</p>



<pre><code>&gt; Math.E
  2.718281828459045
</code></pre>



<p>One method of calculating <em>e</em> is as follows:</p>

<p><img src="https://web.archive.org/web/20170702101405im_/http://farm4.staticflickr.com/3769/11059902465%5F34745ebaf8%5Fo.png" alt=""/></p>

<p>In English, <em>e</em> is the limit as n approaches infinity of 1 and an nth raised to the nth power. You can see below how progressively larger values for n begin to converge on the value above:</p>



<pre><code>&gt; function e(n) &#123; return Math.pow(1 + 1/n, n); &#125;
  undefined
&gt; e(1)
  2
&gt; e(10)
  2.593742460100002
&gt; e(100)
  2.704813829421529
&gt; e(1000)
  2.7169239322355203
&gt; e(10000000)
  2.7182816939803724
</code></pre>



<p>How high, then, do we need to go to reach the precision of the built-in constant? The answer is unsurprising: <code>2<sup>52</sup></code>. Javascript is capable of representing higher values (in fact, it can go as high as <code>2<sup>1023</sup></code>), however that's the limit at which it maintains unit-accuracy. For example:</p>



<pre><code>&gt; Math.pow(2, 52)
  4503599627370496
&gt; Math.pow(2, 52) + 1
  4503599627370497

&gt; Math.pow(2, 53)
  9007199254740992
&gt; Math.pow(2, 53) + 1
  9007199254740992
&gt; Math.pow(2, 53) + 2
  9007199254740994
</code></pre>



<p>When you raise 2 to the 53rd or higher power, you can no longer maintain accuracy down to the one's place. A similar thing happens with fractional portions at the same scale:</p>



<pre><code>&gt; 1 + 1 / Math.pow(2, 52)
  1.0000000000000002
&gt; 1 + 1 / Math.pow(2, 53)
  1
</code></pre>



<p>So <code>2<sup>52</sup></code> is the limit of scale and accuracy. Let's plug that into the above e function:</p>



<pre><code>&gt; e(Math.pow(2, 52))
2.718281828459045
</code></pre>



<p>That exactly matches Math.E, and is accurate to the mathematical constant <em>e</em> within <code>2.3 &times; 10<sup>-16</sup></code>. If we move n up or down by just 1, we lose accuracy:</p>



<pre><code>&gt; e(Math.pow(2, 52) + 1)
  2.7182818284590455
</code></pre>



<p>This gives us an extra digit, but the accuracy is slightly less. We're off by <code>2.6 &times; 10<sup>-16</sup></code></p>



<pre><code>&gt; e(Math.pow(2, 52) - 1)
  2.718281828459044
</code></pre>



<p>As expected, going lower, while maintaining float64 precision, is less accurate according to the limit equation. In this case, the discrepancy is <code>1.2 &times; 10<sup>-15</sup></code></p>

<p>So that's <em>e</em>, Javascript numbers, double precision 64 bit binary floats, and behind the scenes type casts. I'll leave you with a quick reason not to try to implement this with bitshifting instead of Math.pow(). I mentioned above that the rules for bitshifting in Javascript imply they are accurate only when the number in question can be cast into a 32 bit int. Observe what happens with a larger number:</p>



<pre><code>&gt; e(1 &lt;&lt; 52)
  2.7182805322756565
&gt; // Way off!
  undefined
&gt; 1 &lt;&lt; 52
  1048576
&gt; 1 &lt;&lt; (52 - 32)
  1048576
&gt; 1 &lt;&lt; 32
  1
</code></pre>



<p>Enjoy!</p>


			</div>
			<hr/>
		

	</div>
	<script src="/web/20170702101405js_/http://curtisautery.appspot.com/static/jquery/jquery-2.0.3.min.js"></script>
	<script src="/web/20170702101405js_/http://curtisautery.appspot.com/static/bootstrap/js/bootstrap.min.js"></script>
</body>
</html>
<!--
     FILE ARCHIVED ON 10:14:05 Jul 02, 2017 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 17:36:54 Oct 26, 2020.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  RedisCDXSource: 118.627
  CDXLines.iter: 16.085 (3)
  PetaboxLoader3.datanode: 1828.352 (4)
  load_resource: 765.188
  esindex: 0.01
  LoadShardBlock: 1646.948 (3)
  PetaboxLoader3.resolve: 543.242
  exclusion.robots.policy: 0.354
  exclusion.robots: 0.369
  captures_list: 1784.56
-->